{% extends "admin/base_site.html" %}
{% block content %}
<div style="display:flex; flex-direction: row; column-gap: 50px;">
    <nav>
        {% for crumb in breadcrumb %}
            {% if forloop.first %}
                <a href="{{ crumb.path }}">{{ crumb.name }}</a> /
            {% elif not forloop.last %}
                <a href="?path={{ crumb.path }}">{{ crumb.name }}</a> /
            {% else %}
                {{ crumb.name }}
            {% endif %}
        {% endfor %}
    </nav>

    <p><a href="?path={{ current_path }}&download=1" class="button">Download file</a></p>
</div>


{% if rows %}
    <table>
        <thead>
            <tr>
                {% for column_name in column_names %}
                    <th>{{ column_name }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in rows %}
                <tr>
                    {% for value in row %}
                        {% if forloop.counter == column_names|length and value %}
                            <td><button type="button" class="button" onclick="toggleTraceback(this)" id="show-traceback-button">Show Traceback</button></td>
                        {% else %}
                            <td>{{ value }}</td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% if row|length == column_names|length and row|last %}
                <tr class="traceback-row">
                    <td colspan="{{ column_names|length }}" style="padding: 5px; border: none;">
                        <div class="traceback-wrapper" style="max-height: 0; overflow: hidden; transition: max-height 0.2s;"> <!-- `max-height` is set inline, so it can be read in the script tag -->
                            <pre>{{ row|last }}</pre>
                        </div>
                    </td>
                </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <pre>{{ content }}</pre>
{% endif %}

<style>
.traceback-wrapper pre {
    overflow-x: auto;
}

a.button,
#show-traceback-button {
    font-size: 0.85rem;
    padding: 4px 8px;
}
</style>

<script>
function toggleTraceback(button) {
    const tr = button.closest("tr");
    const wrapper = tr.nextElementSibling.querySelector(".traceback-wrapper");

    if (wrapper.style.maxHeight && wrapper.style.maxHeight !== "0px") {
        wrapper.style.maxHeight = "0";
    } else {
        wrapper.style.maxHeight = wrapper.scrollHeight + "px";
    }
}
</script>
{% endblock %}
